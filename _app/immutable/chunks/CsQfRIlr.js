import{f as p,a as f}from"./xhJEdZQq.js";import{i as Y}from"./Dgg8FQQQ.js";import{o as Z}from"./v5Ghx0Jz.js";import{v as ee,z as te,o as r,q as a,u as s,B as ie,y as N,g as e,m as O,A as se,s as _,an as ve,w as le,x as ne,C as ce}from"./C3Hdb8d4.js";import{s as j,e as Q,r as me}from"./BY-y2o2q.js";import{i as W}from"./BMk0_yKg.js";import{e as F,i as J,s as ue,b as ae}from"./BH1KgleA.js";import{s as de,b as fe}from"./DEkdmhtJ.js";import{s as _e,a as pe}from"./BaltXBWv.js";import{i as be,u as ge,l as X}from"./CTz-H6Ma.js";function he(i){return function(...u){var w=u[0];return w.preventDefault(),i==null?void 0:i.apply(this,u)}}const re="https://script.google.com/macros/s/AKfycbzWb1e1KGK21L_IhjajGntboDrfV-1uV74YaAZhoTc-e1XbFkVDkGiqEoy8iyShavnDQg/exec";async function ye(i){try{const u=await fetch(re,{method:"POST",body:JSON.stringify({action:"add",...i})});return console.log("test"),await u.json()}catch(u){throw console.error("Error adding comment:",u),u}}async function je(){try{return await(await fetch(re,{method:"POST",body:JSON.stringify({action:"get"})})).json()}catch(i){throw console.error("Error fetching comments:",i),i}}var xe=p("<option> </option>"),we=p('<button type="button">⭐</button>'),Ce=p('<div class="user-info svelte-3mv5ju"><img alt="Profile" class="svelte-3mv5ju"/> <span> </span></div> <form><div class="form-group svelte-3mv5ju"><label for="subject" class="svelte-3mv5ju">เลือกวิชา:</label> <select id="subject" required class="svelte-3mv5ju"><option>-- เลือกวิชา --</option><!></select></div> <div class="form-group svelte-3mv5ju"><label for="rating" class="svelte-3mv5ju">คะแนนความพึงพอใจ:</label> <div class="rating svelte-3mv5ju"><!> <span> </span></div></div> <div class="form-group svelte-3mv5ju"><label for="comment" class="svelte-3mv5ju">ความคิดเห็น:</label> <textarea id="comment" placeholder="แสดงความคิดเห็นเกี่ยวกับวิชานี้..." rows="4" required class="svelte-3mv5ju"></textarea></div> <button type="submit" class="submit-btn svelte-3mv5ju">ส่งความคิดเห็น</button></form>',1),Se=p('<div class="login-prompt svelte-3mv5ju"><p>กรุณาเข้าสู่ระบบด้วย LINE เพื่อแสดงความคิดเห็น</p> <button class="login-btn svelte-3mv5ju">เข้าสู่ระบบด้วย LINE</button></div>'),De=p('<div class="comment-form svelte-3mv5ju"><h2 class="svelte-3mv5ju">แสดงความคิดเห็นเกี่ยวกับวิชาเรียน</h2> <!></div>');function Je(i,u){ee(u,!1);const[w,E]=_e(),b=()=>pe(ge,"$userProfile",w);let o=O(""),C=O(""),S=O(5),R=["Creative Class","167-ธุรกิจ Online","หลักการโปรแกรมคอมพิวเตอร์ทางธุรกิจและเทคโนโลยีดิจิทัล","267-การจัดการฐานข้อมูล","การพัฒนาแอพพลิเคชั่นทางธุรกิจ"];Z(async()=>{await be()});async function U(){if(!b()){await X();return}if(!e(o)||!e(C).trim()){alert("กรุณากรอกข้อมูลให้ครบถ้วน");return}try{const l={userId:b().userId,displayName:b().displayName,subject:e(o),comment:e(C).trim(),rating:e(S)};(await ye(l)).success&&(_(o,""),_(C,""),_(S,5),alert("ส่งคอมเม้นต์เรียบร้อย!"))}catch(l){console.error(l),alert("เกิดข้อผิดพลาด กรุณาลองใหม่")}}Y();var D=De(),k=r(a(D),2);{var q=l=>{var g=Ce(),t=ie(g),n=a(t),v=r(n,2),P=a(v);s(v),s(t);var c=r(t,2),h=a(c),G=r(a(h),2);N(()=>{e(o),se(()=>{})});var y=a(G);y.value=y.__value="";var T=r(y);F(T,1,()=>R,J,(d,x)=>{var m=xe(),V={},M=a(m,!0);s(m),N(()=>{V!==(V=e(x))&&(m.value=(m.__value=e(x))??""),j(M,e(x))}),f(d,m)}),s(G),s(h);var L=r(h,2),$=r(a(L),2),A=a($);F(A,0,()=>[1,2,3,4,5],J,(d,x)=>{var m=we();N(()=>ue(m,1,`star ${x<=e(S)?"active":""}`,"svelte-3mv5ju")),Q("click",m,()=>_(S,x)),f(d,m)});var I=r(A,2),H=a(I);s(I),s($),s(L);var z=r(L,2),K=r(a(z),2);me(K),s(z),ve(2),s(c),N(()=>{de(n,"src",b().pictureUrl),j(P,`สวัสดี ${b().displayName??""}`),j(H,`${e(S)??""}/5`)}),ae(G,()=>e(o),d=>_(o,d)),fe(K,()=>e(C),d=>_(C,d)),Q("submit",c,he(U)),f(l,g)},B=l=>{var g=Se(),t=r(a(g),2);s(g),Q("click",t,function(...n){var v;(v=X)==null||v.apply(this,n)}),f(l,g)};W(k,l=>{b()?l(q):l(B,!1)})}s(D),f(i,D),te(),E()}var Le=p("<option> </option>"),Ne=p('<div class="loading svelte-1vsn6oe">กำลังโหลด...</div>'),Oe=p('<div class="no-comments svelte-1vsn6oe">ยังไม่มีความคิดเห็น</div>'),Ee=p('<div class="comment-card svelte-1vsn6oe"><div class="comment-header svelte-1vsn6oe"><div class="user-name svelte-1vsn6oe"> </div> <div class="subject-tag svelte-1vsn6oe"> </div> <div class="timestamp svelte-1vsn6oe"> </div></div> <div class="rating svelte-1vsn6oe"> </div> <div class="comment-text svelte-1vsn6oe"> </div></div>'),Pe=p('<div class="comments"></div>'),$e=p('<div class="comments-list svelte-1vsn6oe"><h2 class="svelte-1vsn6oe">ความคิดเห็นจากนักเรียน</h2> <div class="filter svelte-1vsn6oe"><label for="subject-filter">กรองตามวิชา:</label> <select id="subject-filter" class="svelte-1vsn6oe"></select></div> <!></div>');function Re(i,u){ee(u,!1);const w=O();let E=O([]),b=O(!0),o=O("");const C=["ทั้งหมด","Creative Class","167-ธุรกิจ Online","หลักการโปรแกรมคอมพิวเตอร์ทางธุรกิจและเทคโนโลยีดิจิทัล","267-การจัดการฐานข้อมูล","การพัฒนาแอพพลิเคชั่นทางธุรกิจ"];Z(async()=>{await S()});async function S(){try{_(b,!0);const t=await je();t.success&&_(E,t.data.reverse())}catch(t){console.error("Error loading comments:",t)}finally{_(b,!1)}}function R(t){return new Date(t).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function U(t){return"⭐".repeat(t)+"☆".repeat(5-t)}le(()=>(e(o),e(E)),()=>{_(w,e(o)&&e(o)!=="ทั้งหมด"?e(E).filter(t=>t.subject===e(o)):e(E))}),ne(),Y();var D=$e(),k=r(a(D),2),q=r(a(k),2);N(()=>{e(o),se(()=>{})}),F(q,5,()=>C,J,(t,n)=>{var v=Le(),P={},c=a(v,!0);s(v),N(()=>{P!==(P=e(n))&&(v.value=(v.__value=e(n))??""),j(c,e(n))}),f(t,v)}),s(q),s(k);var B=r(k,2);{var l=t=>{var n=Ne();f(t,n)},g=(t,n)=>{{var v=c=>{var h=Oe();f(c,h)},P=c=>{var h=Pe();F(h,5,()=>e(w),J,(G,y)=>{var T=Ee(),L=a(T),$=a(L),A=a($,!0);s($);var I=r($,2),H=a(I,!0);s(I);var z=r(I,2),K=a(z,!0);s(z),s(L);var d=r(L,2),x=a(d,!0);s(d);var m=r(d,2),V=a(m,!0);s(m),s(T),N((M,oe)=>{j(A,e(y).displayName),j(H,e(y).subject),j(K,M),j(x,oe),j(V,e(y).comment)},[()=>R(e(y).timestamp),()=>U(e(y).rating)],ce),f(G,T)}),s(h),f(c,h)};W(t,c=>{e(w).length===0?c(v):c(P,!1)},n)}};W(B,t=>{e(b)?t(l):t(g,!1)})}s(D),ae(q,()=>e(o),t=>_(o,t)),f(i,D),te()}export{Je as C,Re as a};
